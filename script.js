/* ---------- KSB DICTIONARY ---------- */
const KSB_DICTIONARY = {
  K2:"How different learning delivery channels (face-to-face, blended or digital) contribute to effective learning",
  K4:"The latest learning practice",
  K8:"The various L&D roles required for effective learning and development in an organisation",
  K9:"Their roles and responsibilities within the L&D structure",
  K10:"The policies and processes required for effective organisational learning",
  K12:"How internal information systems can support learning",
  K13:"How technology supports learning, including digital platforms and delivery channels",
  S11:"Monitor a learner’s progress and deliver motivational and developmental feedback",
  S12:"Manage participation, attitudes and behaviours to reach learning objectives",
  S13:"Use effective coaching skills to enable learners to achieve learning objectives",
  S17:"Communicate and influence through a range of media, adapting style to suit the audience",
  S18:"Build trust and sound relationships with customers, learners and colleagues",
  S19:"Handle conflict and sensitive situations professionally and confidentially",
  S20:"Support colleagues and collaborate within the team to achieve results",
  B1:"Proactively look, listen and question to understand and learn (reflection)",
  B2:"Show interest in new ideas and seek feedback for self-development",
  B3:"Willingness to explore and take risks to learn something new",
  B5:"Act with integrity and demonstrate organisational values",
  B7:"Show energy and enthusiasm for work, focusing on achieving outcomes",
  B8:"Responsiveness and flexibility to changing business and learner needs",
  B9:"Personal resilience to manage competing priorities",
  B10:"Confidence in delivery"
};

/* ---------- YOUR FULL ORIGINAL DATA (UNCHANGED) ---------- */

const data = {
  December: [
    {
      title: "DVS2 Conference",
      date: "04/12/2025",
      jobType: "off-job",
      sections: [
        {
          heading: "What happened",
          content: "I went to a conference for the new VBS update. We learnt about what new features were coming and even some examples on how they are used currently elsewhere. One example of which was a group using a built simulator plus VBS to simulate mortar fire and learn about trajectory and impact. My mentor asked me to send an email to him of how we could apply things from the new update into our practices at work/our current training. As someone with no army experience and fresh perspective on the way training is run currently (having only been working there a month)."
        },
        {
          heading: "Reflection",
          content: "After reading my mentors notes I became aware that while my more ambitious ideas would be great, Bohemia (VBS creators) is a company like any other who weigh the needs of the business against the needs of the stakeholders. One person or branch wanting a number of new items and interactions in VBS is unlikely to happen unless the demand is high. Even if it was to happen it wouldn't be for some years. That was my first instance of understanding that while training is the goal/objective, we are a business and business needs come first. When future updates come out, I will focus on applying the latest learning practice and how we can use the update as is, keeping within the current capabilities to enhance training."
        },
        {
          heading: "Linked KSBs",
          content: "B1, B2, B7, K4, K13"
        }
      ]
    },
    {
      title: "Team Introduction",
      date: "17/12/2025",
      jobType: "off-job",
      sections: [
        {
          heading: "What happened",
          content: "I spent time with the other members of the L&D team on site. This included the media officer, training creator, scheduler. I shadowed their day-to-day tasks and got a run down from each person on why their role is important and how it contributes to the goal of training creation and delivery."
        },
        {
          heading: "Feelings",
          content: "I was worried about how it would go before hand. Having never been in this situation and not knowing the first thing about L&D I felt a bit out of my depths. However, by the end I was glad I did it."
        },
        {
          heading: "Evaluation",
          content: "I found it helped me better understand the different roles in an L&D team and how they work together. The trial of reading the schedule and booking venues for specific courses. I wish I could have asked better questions."
        },
        {
          heading: "Analysis",
          content: "I learnt more about the priorities of the company, the many steps it takes for a course to be developed as well as the shift being pushed within the company in ratios of classroom and practicals. Requiring courses to be more practical based now. I learnt the start of the year is busy for media and scheduling. I think I needed to remember that I was there to learn because I had little knowledge on the roles, I think that would have led me to ask more questions and take notes."
        },
        {
          heading: "Conclusion",
          content: "This experience increased my understanding of L&D, how each role contributes to training delivery. As well as the importance of communicating and planning within the different departments. It also taught me briefly about the current issues specific to our company and team."
        },
        {
          heading: "Action plan",
          content: "From now on I will say yes to any opportunities of shadowing/learning about other roles as it was beneficial and could always bring about more questions and answers."
        },
        {
          content: "Here I used the Gibbs reflective cycle. It helped me think in more detail about my experience. If I hadn't used this reflective method I would not have thought about what I could do better next time or create an action plan."
        },
        {
          heading: "Linked KSBs",
          content: "K2, K8, K9, B1"
        }
      ]
    },
    {
      title: "Blender Introduction",
      date: "06/12/2025",
      jobType: "on-job",
      sections: [
        {
          content: "After the visit with model creators for VBS, I showed an interest in Blender and was told to try the donut tutorial. Currently our workplace has a 3D modeller, however the models have to be converted from the software he uses to Blender and then converted again to create the model in VBS. Learning to create models in Blender will cut a step out and potentially speed up the process as super detailed models are not needed for what is being done."
        },
        {
          heading: "Linked KSBs",
          content: "B2, B3"
        }
      ]
    }
  ],

  January: [
    {
      title: "Heatmap and CPD Creation",
      date: "08/01/2025",
      jobType: "off-job",
      sections: [
        {
          content: "I created a heatmap, based on the KSBs to track how I develop over the course of this programme. I also created a CPD, Continuing Professional Development, log after reading through the EPA and Gateway guidelines.",
         images: ["https://amanchanda1102-bit.github.io/learning-journal/heatmap.png"],
          pdf: "https://amanchanda1102-bit.github.io/learning-journal/CPD.pdf"},
        {
          heading: "Linked KSBs",
          content: "B2"
        }
      ]
    },
    {
      title: "Feedback + PDP",
      date: "22/01/2025",
      jobType: "off-job",
      sections: [
        {
          content: "I sent out a feedback form to my mentor. Based on the feedback I received from him, I created an analysis document in which I identified areas of development. I proceeded to use this analysis to create a PDP, Personal Development Plan.",
          pdf: "https://amanchanda1102-bit.github.io/learning-journal/PDP.pdf"},
        {
          heading: "Linked KSBs",
          content: "B2"
        }
      ]
    }
  ],

  February: [
    {
      title: "Tech use at Babcock",
      date: "19/02/2025",
      jobType: "off-job",
      sections: [
        {
          content: "I analysed the effectiveness of technology used by my company, including other technology that could be used, the pros and cons, and what it would add to the business. Also taking into consideration less typical learning technology such as AI.",
          pdf: "https://amanchanda1102-bit.github.io/learning-journal/technology.pdf"
        },
        {
          heading: "Linked KSBs",
          content: "K12, K13"
        }
      ]
    }
  ],

March: [
  {
    title: "VBS Model Creation",
    jobType: "on-job",
    date: "05/03/2025",
    sections: [
      {
        content: "Created a building using blender, it is needed to redesign a training ground. However when it came to learning how models are put into the VBS system it became evident this was not going to be usable. Well it could be but it would take a lot more time and effort than just starting again. My mentor suggested learning the process of converting the buildings, so they can be built with that process in mind. making it easier in the long run",
        youtube: "https://youtu.be/0FQ8kL2uKUY"
      },
      {
        content: "I started again, with a basic test model. The goal was to get this into VBS. Which suceeded. As suggested in the feedback from my mentor I need to be more confident in my abilities, starting with a simpler model, building up from the basics will give me a better knowledge foundation helping me feel more confident in my modelling skills. It meant I now knew the process better and could start with the actual models needed. The only issue was the texturing. However since there was going to be a call to review progress buildings with no texture were good even just to show the possibilities."
      },
      {
        images: [
          "https://amanchanda1102-bit.github.io/learning-journal/images/cube.jpg",
          "https://amanchanda1102-bit.github.io/learning-journal/images/pinkhouse.png",
          "https://amanchanda1102-bit.github.io/learning-journal/images/test.png"
        ]
      },
      {
        content: "These are the untextured 3D models. Although I followed a guide on texturing, I couldn't get part a section and so emailed the company (the simulation software company) for assistance. In the mean while, Since I have the model creation part down, I start on smaller models such as train tracks and fences that will be on the training ground. Rather than waiting for an answer and then doing the whole model from scratch I will now have base models that 1. can be shown for demonstration purposes and 2. only need texturing as a last step. This will speed up my ability to achieve the outcomes."
      },
      {
        heading: "Linked KSBs",
        content: "B2, B3, B7, K4"
      }
    ]
  }
],


  April: [
    {
      title: "Policies Overview",
      date: "02/04/2025",
      jobType: "on-job",
      sections: [
        {
          content: "I compiled an overview of the policies and processes that affect Babcock's L&D department. This included what exists, what effect it has, and what other policies and procedures might be useful.",
          pdf: "https://amanchanda1102-bit.github.io/learning-journal/policies.pdf"
        },
        {
          heading: "Linked KSBs",
          content: "K10"
        }
      ]
    }
  ],

  May: [
    {
      title: "Communication Skills",
      date: "10/05/2025",
      jobType: "on-job",
      sections: [
        {
          content: "I pulled together a range of documents demonstrating effective communication skills using different mediums. I reflected on how the most appropriate communication medium for different tasks and audiences was selected.",
          pdf: "https://amanchanda1102-bit.github.io/learning-journal/communication.pdf"
        },
        {
          heading: "Linked KSBs",
          content: "S17"
        }
      ]
    },
    {
      title: "VBS Training Exploration",
      date: "28/05/2025",
      jobType: "on-job",
      sections: [
        {
          content: "When learning to use vbs I went through the same basic training as the course students will. I had many questions on why things were done certain ways. As well as frustration with how long it was. When asked to go home and play around with VBS, I looked at making a mini version of the training (which I think is what led my mentor to creating a short efficient, easier to understand version of the training,- still in beta currently, but once completed will cut the basic training time by more than half.)"
        },
        {
          heading: "Linked KSBs",
          content: "S20, B1, B5"
        }
      ]
    }
  ],

  June: [
    {
      title: "Babcock Values Reflection",
      date: "11/06/2025",
      jobType: "off-job",
      sections: [
        {
          content: "I provided examples of where I have behaved in accordance with the values of Babcock."
        },{content: `Behaving in accordance with the values of the organisation:
Our values at babcock are:
Be kind, courageous, think:outcome, own & deliver, curious 
And safety`},

        {content: "Collaboration: collaborating with the different teams to be able to complete my apprenticeship tasks. The apprenticeship tasks are not fully inline with what we do here, so making an effort to meet the different teams and understand fully what they do. And to apply that to the apprenticeship tasks and see what things we'd have to find other methods for.  "
        },
{ "content": "Safety: I regularly raise safety concerns or faults to my mentor. The heater, lights etc. Other more important ones, like whether there are fire indicators for the deaf. Or a rule that's not being followed well." },

{ "content": "Innovation/curious: I regularly ask questions: why do we do it like this, why can't we do this. Suggesting improvements or different methods if I have any. E.g. suggesting short videos instead of text on some ppt slides for independent learning or preemptively loading trainees to prevent human error. I was curious about Blender, so my mentor gave me a tutorial to follow, which eventually led me to successfully learning how to create models that can be converted into VBS assets." }
,

        {
          heading: "Linked KSBs",
          content: "B5"
        }
      ]
    },
    {
      title: "Collaboration Case Study",
      date: "25/06/2025",
      jobType: "on-job",
      sections: [
        {
          content: "I created a case study highlighting where I have delivered the outcomes of my work through collaboration, with a willingness to question and challenge as appropriate. Includes a witness statement.",
          pdf: "https://amanchanda1102-bit.github.io/learning-journal/caseStudy.pdf"
        },
        {
          heading: "Linked KSBs",
          content: "S20, B6"
        }
      ]
    }
  ],

  July: [
{
  title: "Model Guide & Shader Testing",
  jobType: "off-job",
  date: "23/07/2025",
  sections: [
    {
      images: ["https://amanchanda1102-bit.github.io/learning-journal/images/guide.jpg",
               "https://amanchanda1102-bit.github.io/learning-journal/images/text.jpg"],
      content: "Around here there was a second meeting about the models. There was word about seeing if other people on different sites would be interested in also making custom models for specific training needs. I decided to make a guide. Not only for myself as a reminder on how to do things but also for possible internal company use. As I’m sure I’m not the only one that will find the provided guides absolutely useless."
    },
    {
      images: ["https://amanchanda1102-bit.github.io/learning-journal/images/pinkfence.jpg"],
      content: "In the guide there are two types of shaders. I realised since these are simple objects I may be able to use the simple shader. It also didn’t seem to work for me. As shown below."
    },
    {
      images: ["https://amanchanda1102-bit.github.io/learning-journal/images/group4.jpg",
               "https://amanchanda1102-bit.github.io/learning-journal/images/group2.jpg"],
      content: "I then tried to see if I could reverse engineer an example folder/item provided by the company. I recreated their streetlight example for my fence using a YouTube tutorial on ‘baking’ – creating images of the texture to slap on the objects. This worked! The only caveat being the baking process must be redone if adjustments are made to the model in Blender."
    },
    {
      heading: "Linked KSBs",
      content: "B2, B3"
    }
  ]
}
  ],

  August: [
    {
      title: "Learning Event Setup Examples",
      date: "20/08/2025",
      jobType: "on-job",
      sections: [
        {
          content: "I show examples of how I have set up and set down learning events, demonstrating how objectives were achieved, stakeholder/learner management, inclusion, follow-up/evaluation, and monitoring learner progress.",
        pdf: "https://amanchanda1102-bit.github.io/learning-journal/setup.pdf"
        },
        {
          heading: "Linked KSBs",
          content: "S8, S11"
        }
      ]
    }
  ],

  September: [
    {
      title: "Coaching Session",
      date: "03/09/2025",
      jobType: "off-job",
      sections: [
        {
          heading:"concrete experience", 
          content: "We had a session on coaching as part of the apprenticeship course"
        },
        {
          heading:"Reflective observation", 
          content: "we learnt about the qualities of a good coach, there was emphasis on the importance of active listening. we were taught about the GROW model – Goal, Reality, Options, Way forward."
        }, 
        {
          heading:"Active experimentation", 
          content: " I practiced what was learnt in the session that week by coaching my colleague. I used the GROW method to ask questions. We found that she wanted to do more learning, For the what now it was decided she would find an area to develop a skill or a topic to learn more about. I contacted her about blender and model making asking if that would be something she would like. she asked if there was a short intro she could try to see if it was for her. I suggested the donut tutorial I started out with."
        }, 
        {
          heading:"Abstract conceptualization", 
          content: "Using the sheet I found from my previous course made it much easier as I had questions I could rattle off. It also meant I could focus more on listening to what she had to say. I do think I still struggled with active listening slightly. I believe this is just because of a lack of practice and thinking too much. So, if I was to do this again, I will have to practice the skill of active listening first."
        },
        {
          heading:"Witness testimonial", 
          content: "Colleague – I had a coaching session with Angel as part of her apprenticeship work and found it helpful and well structured. She explained the session clearly and used the GROW model to guide the conversation, which made it easy to follow. She asked thoughtful questions and created a comfortable space for me to speak openly. Angel was encouraging and supportive throughout and helped me think about my goals and next steps in a practical way. At times she seemed to be thinking ahead about her next question, but she was aware of this and reflected on it afterwards, showing a genuine desire to improve. Overall, it was a positive experience and I can see her developing into a confident and effective coach with more practice."
        }, 
        {
          heading: "Linked KSBs",
          content: "S13, B1"
        }
      ]
    },
    {
      title: "PDP Updates",
      date: "03/09/2025",
      jobType: "off-job",
      sections: [
        { 
          content: "In my progress review with the help of my coach I realised I was not updating my pdp enough, which meant I was not keeping up with tasks properly. From that progress review onwards, I updated it monthly. I found I was keeping up with tasks much easier and when I was asked where I was or what I had to do left I had a better picture.",
          images: ["https://amanchanda1102-bit.github.io/learning-journal/images/PDP1.jpg",
                 "https://amanchanda1102-bit.github.io/learning-journal/images/PDP2.jpg"]
        },
        {
          heading: "Linked KSBs",
          content: "B1, B2"
        }
      ]
    }
  ],

  October: [
    {
      title: "Cadets Training Delivery",
      date: "09/10/2025",
      jobType: "on-job",
      sections: [
        {
          content: "I was asked to cover training delivery for a group of cadets. I had never done the speaking part for face-to-face training before so I was extremely nervous, my mentor put no pressure on me to do it, saying we could cancel if needed. I ended up doing it and was glad I did it. There were a couple of hiccups but luckily Steve was online from home to help with any computer issues. nowadays people love videos for learning and info. So I put up videos on VBS and the new updates for while we were waiting for everyone to settle, and I think that got them interested in what we were going to do. I think doing this for all levels of training could help gain interest in VBS itself. I also created a short presentation so there were visuals for what i was talking about. I could then leave this up at the end so the basic questions of “where can i find this” can be answered by looking at the screen. One issue I came across was a pair of girls had had a bad day and so wasn’t really interested in the main task/game, she had asked about tanks and so I moved her to a corner of the map and spawned some tanks and air vehicles in for her to look at and play around with. Realistically they are here to learn about the latest learning practices which is VBS, the method in which they learn about it isn’t as important. I’d rather her be engaged in that than sitting there twiddling her thumbs or on her phone."
        }, 
        {
          content: "If I were to do it again, I would have talked slower and taken longer breaks to compose myself and make sure everything was running properly. In the end something in the game broke and one team was able to respawn constantly leading to the two teams getting bored. I think next time I will make sure to pay more attention to how the game is playing out, something I had never thought about when just assisting training delivery."
        },
        {
          heading: "Linked KSBs",
          content: "S12, S19, S17"
        }
      ]
    },
    {
      title: "Modeling Guidance for Co-worker",
      date: "15/10/2025",
      jobType: "off-job",
      sections: [
        {
          content: "My co-worker said she would like to learn more about models after completing the donut tutorial. So, I gave her the documents I created as a starting point. I later checked in on my coworker to see how she was getting along with the models offering help if needed. she was having issues so i looked over the work and offered a 1 to 1 (as I’ve found when asking for help previously it’s easy to misunderstand and be confused by text instructions when it comes to model making)"
        },
        {
          heading: "Linked KSBs",
          content: "S11"
        }
      ]
    },
    {
      title: "Comms Training",
      date: "28/10/2025",
      jobType: "on-job",
      sections: [
        {
          content: "I was asked to cover training delivery for a troop/commander course. My only practice/experience was the 2-hour cadet training a week earlier. I was more nervous about this because it is an entirely different group of people. Cadets are there to have fun and learn about the latest learning practices in the army whereas the troops are on an actual course. I therefore was not confident enough to do it completely on my own. my mentor, the group leader and I spoke and came to a compromise where we work together, I run VBS and the leader of the group speaks on my behalf. I was told there would be a much larger group than there was. In hindsight I think I could have led the small group myself. However, I’m still shocked Id even agree to assist on my own, Steve was not available for the entire training period."
        },
        {
          content: "I believe the cadet training experience gave me enough confidence to agree to this one. I also learnt that there are some things I don’t know how to do well. Next time we have training I know what I am looking to learn and will write down the steps for that section of the training."
        },
        {
          heading: "Linked KSBs",
          content: "S18, B3"
        }
      ]
    }
  ],

  November: [
    {
      title: "Feedback Form Reflection",
      date: "01/11/2025",
      jobType: "off-job",
      sections: [
        {
          heading: "Experience",
          content: "I sent out the same feedback from a year ago to the same person (my mentor) to see how I have changed. This feedback from has mostly 8 to 10s with one or two 7s."
        },
        {
          heading: "Reflection",
          content: "I think the relatively high scores are mostly due to two reasons. First reason: I was new to the company and role when I had given the feedback form out. It was hard for him to give me high numbers or any number at all considering he had not seen those skills in action. The second reason being improvement. Having been in the role now for over a year and having learnt everything I have from my mentor, the apprenticeship as well as the tasks I was made to complete all lead to improvements in my L&D practices."
        },
        {
          heading: "Action",
          content: "Two things noted were to keep questioning things and be more confident in the role. In terms of how to be more confident he suggested getting internal confidence by knowing the topic inside out. I therefore think shadowing sessions/taking notes and working our gaps in knowledge is the next step. As well as just regular practice of VBS. These two things will also make me question why we do things that way and whether there are better methods."
        },
        {
          heading: "Linked KSBs",
          content: "S11, S16, B2"
        }
      ]
    }
  ]
};

const LIP_KSB_MONTHS = {
  K2: ["Poor","Poor","Poor","Poor","Average","Poor","Average","Good","Good","Good","Good","Good"],
  K4:["Poor","Poor","Average","Average","Average","Average","Average","Average","Good","Good","Good","Good"],
  K8: ["Poor","Average","Average","Average","Average","Good","Good","Good","Good","Good","Good","Good"],
  K9: ["Poor","Poor","Average","Average","Average","Average","Average","Average","Good","Good","Good","Good"],
  K10:["Poor","Poor","Average","Average","Average","Average","Average","Average","Good","Good","Good","Good"],
  K12:["Poor","Poor","Average","Average","Average","Average","Average","Good","Good","Good","Good","Good"],
  K13:["Poor","Poor","Average","Average","Average","Average","Average","Good","Good","Good","Good","Good"],
  S1: ["Poor","Poor","Poor","Poor","Poor","Poor","Average","Average","Average","Good","Good","Good"],
  S10:["Poor","Poor","Poor","Poor","Poor","Poor","Average","Average","Good","Good","Good","Good"],
  S11:["Poor","Poor","Poor","Poor","Poor","Poor","Average","Average","Good","Good","Good","Good"],
  S12:["Poor","Poor","Poor","Poor","Poor","Poor","Average","Average","Good","Good","Good","Good"],
  S13:["Poor","Average","Average","Average","Average","Average","Good","Good","Good","Good","Good","Good"],

  B1: ["Poor","Average","Good","Good","Good","Good","Good","Good","Good","Good","Very Good","Very Good"],
  B2: ["Poor","Average","Good","Good","Good","Good","Good","Good","Good","Good","Very Good","Very Good"],
  B3: ["Poor","Average","Good","Good","Good","Good","Good","Good","Good","Good","Good","Good"],
  B7: ["Average","Average","Average","Average","Average","Average","Average","Average","Average","Good","Good","Good"],
  B9: ["Average","Average","Average","Average","Average","Average","Average","Average","Average","Good","Good","Good"]
};

/* ---------- ELEMENTS ---------- */
const grid = document.getElementById("monthsGrid");
const page = document.getElementById("monthPage");
const title = document.getElementById("monthTitle");
const entries = document.getElementById("monthEntries");
const fill = document.getElementById("progressFill");
const label = document.getElementById("progressLabel");
const panel = document.getElementById("contentsPanel");
const overlay = document.getElementById("contentsOverlay");

let completed = JSON.parse(localStorage.getItem("ljCompleted")) || [];


/* ---------- SHOW MONTH GRID ON LOAD ---------- */
grid.style.display = "grid";
page.style.display = "none";
document.getElementById("heatmapPage").style.display = "none";


/* ---------- MONTH BUTTONS ---------- */
Object.keys(data).forEach(m=>{
  const btn = document.createElement("button");
  btn.className="month";
  btn.textContent = m;
  if(completed.includes(m)) btn.classList.add("completed");
  btn.onclick = ()=>openMonth(m);
  grid.appendChild(btn);
});


/* ---------- OPEN MONTH ---------- */
function openMonth(m){

  highlightCurrentMonth(m);

  grid.style.display="none";
  page.style.display="block";
  title.textContent=m;
  entries.innerHTML="";

  data[m].forEach(e=>{

    const d=document.createElement("div");
    d.className="entry";

    const h=document.createElement("h3");
    h.textContent=`${e.title} — ${e.date}`;
    d.appendChild(h);

    if(e.sections){
      e.sections.forEach(sec=>{

        if(sec.heading){
          const strong=document.createElement("strong");
          strong.textContent=sec.heading+":";
          d.appendChild(strong);
          d.appendChild(document.createElement("br"));
        }

        if(sec.content){
          const p=document.createElement("p");
          p.textContent=sec.content;
          d.appendChild(p);
        }

if(sec.images){
  sec.images.forEach(src => {
    const img = document.createElement("img");
    img.src = src;
    img.style.maxWidth = "100%";
    img.style.margin = "10px 0";
    d.appendChild(img);
  });
}

        if(sec.pdf){
          const iframe=document.createElement("iframe");
          iframe.src=sec.pdf;
          iframe.width="100%";
          iframe.height="600";
          iframe.style.border="1px solid #ccc";
          iframe.style.margin="10px 0";
          d.appendChild(iframe);
        }

        if(sec.youtube){
  const iframe = document.createElement("iframe");
  
  // Convert normal YouTube links to embed format if needed
  let ytURL = sec.youtube;
  if(ytURL.includes("watch?v=")){
    const videoId = ytURL.split("watch?v=")[1].split("&")[0];
    ytURL = `https://www.youtube.com/embed/${videoId}`;
  } else if(ytURL.includes("youtu.be/")){
    const videoId = ytURL.split("youtu.be/")[1].split("?")[0];
    ytURL = `https://www.youtube.com/embed/${videoId}`;
  }

  iframe.src = ytURL;
  iframe.width = "100%";
  iframe.height = "400";
  iframe.style.border = "1px solid #ccc";
  iframe.style.margin = "10px 0";
  iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
  iframe.allowFullscreen = true;
  d.appendChild(iframe);
}

        d.appendChild(document.createElement("br"));
      });
    }

    entries.appendChild(d);
  });

  if(!completed.includes(m)) completed.push(m);
  updateProgress();
}


/* ---------- NAV ---------- */
function backToMonths(){
  page.style.display="none";
  grid.style.display="grid";
}

function goHome(){
  page.style.display="none";
  document.getElementById("heatmapPage").style.display="none";
  grid.style.display="grid";
  panel.classList.remove("open");
  overlay.style.display="none";
}


/* ---------- PROGRESS ---------- */
function updateProgress(){
  const pct=Math.round((completed.length/Object.keys(data).length)*100);
  fill.style.width=pct+"%";
  label.textContent=pct+"% complete";

  localStorage.setItem("ljCompleted",JSON.stringify(completed));

  document.querySelectorAll(".month").forEach(b=>{
    b.classList.toggle("completed",completed.includes(b.textContent));
  });
}

function resetProgress(){
  if(confirm("Reset all progress?")){
    completed=[];
    localStorage.removeItem("ljCompleted");
    updateProgress();
  }
}


/* ---------- CONTENTS PANEL ---------- */
document.getElementById("contentsToggle").onclick=()=>{
  panel.classList.add("open");
  overlay.style.display="block";
};

overlay.onclick=()=>{
  panel.classList.remove("open");
  overlay.style.display="none";
};

const contentsList=document.getElementById("contentsList");

Object.entries(data).forEach(([m,es])=>{
  const d=document.createElement("div");
  d.className="contents-month";

  const b=document.createElement("button");
  b.textContent=m;
  b.onclick=()=>openMonth(m);
  d.appendChild(b);

  es.forEach((e,i)=>{
    const c=document.createElement("div");
    c.className="contents-entry";
    c.textContent=`${e.date} — ${e.title}`;

    c.onclick=()=>{
      openMonth(m);
      setTimeout(()=>{
        document.querySelectorAll(".entry")[i]?.scrollIntoView({behavior:"smooth"});
      },150);
    };

    d.appendChild(c);
  });

  contentsList.appendChild(d);
});

function openAllEntries() {
  // Hide month grid and heatmap
  grid.style.display = "none";
  page.style.display = "block";
  title.textContent = "All Entries";
  entries.innerHTML = "";

  // Loop through all months and their entries
  Object.keys(data).forEach(month => {
    data[month].forEach(e => {
      const d = document.createElement("div");
      d.className = "entry";

      const h = document.createElement("h3");
      h.textContent = `${e.title} — ${e.date} (${month})`;
      d.appendChild(h);

      if(e.sections){
        e.sections.forEach(sec => {
          if(sec.heading){
            const strong = document.createElement("strong");
            strong.textContent = sec.heading + ":";
            d.appendChild(strong);
            d.appendChild(document.createElement("br"));
          }
          if(sec.content){
            const p = document.createElement("p");
            p.textContent = sec.content;
            d.appendChild(p);
          }
          if(sec.images){
            sec.images.forEach(src => {
              const img = document.createElement("img");
              img.src = src;
              img.style.maxWidth = "100%";
              img.style.margin = "10px 0";
              d.appendChild(img);
            });
          }
          if(sec.pdf){
            const iframe = document.createElement("iframe");
            iframe.src = sec.pdf;
            iframe.width = "100%";
            iframe.height = "600";
            iframe.style.border = "1px solid #ccc";
            iframe.style.margin = "10px 0";
            d.appendChild(iframe);
          }
          if(sec.youtube){
            const iframe = document.createElement("iframe");
            let ytURL = sec.youtube;
            if(ytURL.includes("watch?v=")){
              const videoId = ytURL.split("watch?v=")[1].split("&")[0];
              ytURL = `https://www.youtube.com/embed/${videoId}`;
            } else if(ytURL.includes("youtu.be/")){
              const videoId = ytURL.split("youtu.be/")[1].split("?")[0];
              ytURL = `https://www.youtube.com/embed/${videoId}`;
            }
            iframe.src = ytURL;
            iframe.width = "100%";
            iframe.height = "400";
            iframe.style.border = "1px solid #ccc";
            iframe.style.margin = "10px 0";
            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
            iframe.allowFullscreen = true;
            d.appendChild(iframe);
          }
          d.appendChild(document.createElement("br"));
        });
      }

      entries.appendChild(d);
    });
  });
}
const filterBar = document.createElement("div");
  filterBar.style.marginBottom = "20px";
  filterBar.style.display = "flex";
  filterBar.style.flexWrap = "wrap";
  filterBar.style.gap = "10px";

  // KSB select
  const ksbSelect = document.createElement("select");
  ksbSelect.innerHTML = `<option value="all">All KSBs</option>` +
    Object.keys(KSB_DICTIONARY)
      .map(k => `<option value="${k}">${k}</option>`)
      .join("");
  ksbSelect.style.padding = "6px 10px";
  ksbSelect.style.borderRadius = "6px";
  ksbSelect.style.border = "1px solid var(--border)";
  filterBar.appendChild(ksbSelect);

  // Job type select
  const typeSelect = document.createElement("select");
  typeSelect.innerHTML = `<option value="all">All Job Types</option>
<option value="on-job">On-Job</option>
<option value="off-job">Off-Job</option>`;
  typeSelect.style.padding = "6px 10px";
  typeSelect.style.borderRadius = "6px";
  typeSelect.style.border = "1px solid var(--border)";
  filterBar.appendChild(typeSelect);

  monthEntries.appendChild(filterBar);
/* ---------- HEATMAP ---------- */
function openHeatmap(){

  grid.style.display="none";
  page.style.display="none";

  const heatPage=document.getElementById("heatmapPage");
  heatPage.style.display="block";

  buildHeatmap();
}

function buildHeatmap(){

  const heatGrid=document.getElementById("heatmapGrid");
  heatGrid.innerHTML="";

  const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

  heatGrid.appendChild(makeCell("KSB","header"));

  months.forEach(m=>{
    heatGrid.appendChild(makeCell(m,"header"));
  });

  Object.entries(LIP_KSB_MONTHS).forEach(([ksb,vals])=>{

    heatGrid.appendChild(makeCell(ksb,"ksb-label"));

    vals.forEach(v=>{
      const cell=document.createElement("div");
      cell.className=`heat-cell ${ratingClass(v)}`;
      cell.textContent=v;
      heatGrid.appendChild(cell);
    });
  });
}

function makeCell(text,type){
  const div=document.createElement("div");
  div.textContent=text;
  div.className="heat-cell";

  if(type==="header") div.classList.add("header");
  if(type==="ksb-label") div.classList.add("ksb-label");

  return div;
}

function ratingClass(v){
  if(v==="Poor") return "heat-poor";
  if(v==="Average") return "heat-average";
  if(v==="Good") return "heat-good";
  if(v==="Very Good") return "heat-verygood";
  return "";
}


/* ---------- HIGHLIGHT ---------- */
function highlightCurrentMonth(month){
  document.querySelectorAll(".contents-month").forEach(m=>m.classList.remove("active"));
  document.querySelectorAll(".contents-month").forEach(m=>{
    if(m.querySelector("button").textContent===month){
      m.classList.add("active");
    }
  });
}


/* ---------- INIT ---------- */
updateProgress();

/* ---------- VIEW ALL BUTTON ---------- */
const viewAllBtn = document.getElementById("viewAllBtn");
if(viewAllBtn){
  viewAllBtn.onclick = openAllEntries;
}


